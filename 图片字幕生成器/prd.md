# 图片字幕生成工具 PRD

## 产品概述
- 提供一个网页工具，将多行字幕文本叠加到图片底部，每一行文字都有统一样式的背景条，形成清晰的“切割感”分隔。
- 支持实时预览、参数可调、生成并保存合成后的图片。

## 目标与用户
- 目标：快速为图片添加规整的多行字幕，适合社交传播、讲解配图、活动回顾等场景。
- 用户：内容创作者、运营人员、设计师与普通用户。

## 术语
- 字幕条：每一行文字背后的矩形背景条。
- 字幕区域：图片底部用于承载所有字幕条的垂直区域。

## 核心功能
- 上传图片
- 字幕设置：字幕高度、字体大小、字体颜色、轮廓颜色、字体样式、字体粗细
- 字幕内容输入（多行）
- 预览（实时）
- 生成字幕图片
- 保存图片
- 状态反馈（成功提示）
- 图片顶部需要有专属水印“么么哒哒”

## 详细需求
### 1. 上传图片
- 支持格式：JPG、PNG、WEBP；最大 20MB。
- 上传后在右侧显示预览，预览区域自适应容器尺寸，保持长宽比。
- 显示文件名，并允许重新选择图片。

### 2. 字幕设置
- 字幕高度（px）：控制每一行“字幕条”的总高度（背景条高度，含内边距）；影响文本垂直居中位置与行间距。
- 字体大小（px）：控制文字字号。
- 字体颜色：十六进制或拾色器选择（默认 #FFFFFF）。
- 轮廓颜色：文字描边颜色（默认 #000000），描边宽度固定为 2px（范围 0–4px，后续可扩展）。
- 字体样式：下拉选择常用字体，默认“微软雅黑”。
- 字体粗细：下拉选择，默认“正常”（等价于 400）。

### 3. 字幕内容输入
- 文本框支持换行；以“换行符”分割为多行字幕。
- 自动忽略空行（仅包含空格或制表符）。
- 行数上限：50 行（防止过度叠加）。

### 4. 预览
- 所有设置与文本变更，预览区域实时刷新。
- 预览中字幕区域锚定在图片底部，超出图片高度时给出警告，不截断原图。
- 预览展示最终导出效果，包括统一的背景条与行间“切割感”。

### 5. 渲染规则（关键）
- 多行按顺序从下至上排列在图片底部。
- 每一行字幕都有“统一风格”的背景条：
  - 背景条颜色、透明度、圆角、内边距一致（同一张图内所有行完全相同）。
  - 背景条宽度覆盖图片可视宽度（左右贴齐图片边缘）。
  - 背景条高度由“字幕高度”参数决定。
  - 背景条之间保留固定垂直间距，形成明显分隔的“切割感”。
- 文本在每一条背景内水平居中、垂直居中显示。
- 文本颜色、描边颜色按设置应用；描边与填充同时绘制，确保可读性。
- 行内过长文本：不自动换行（保留用户的行结构）；若超出背景条宽度，允许文本边缘略超但需提示用户优化文案（后续可选：缩放或省略号）。

### 6. 生成与保存
- 生成字幕图片：将当前预览渲染为合成图（Canvas），分辨率与原图一致。
- 保存图片：导出 PNG（含背景、字幕），文件名：原文件名 + "_caption.png"。
- 生成成功后显示“字幕图片生成成功！”的成功提示。

### 7. 交互与流程
- 流程：
  1) 选择图片
  2) 调整字幕设置
  3) 输入多行文本
  4) 查看预览并微调
  5) 点击“生成字幕图片”
  6) 点击“保存图片”下载
- 操作反馈：
  - 参数异常（如高度为 0）给出表单校验错误。
  - 图片过小或行数导致遮挡过多，提示用户。

### 8. 参数与默认值
- 字幕高度：80px（范围 24–200）
- 字体大小：40px（范围 12–120）
- 字体颜色：#FFFFFF
- 轮廓颜色：#000000（描边 2px）
- 字体样式：微软雅黑
- 字体粗细：正常（400）
- 背景条样式：颜色 rgba(0,0,0,0.6)，圆角 8px，内边距上下 10px、左右 24px
- 行间距（条与条之间的垂直空隙）：8px

### 9. 技术实现建议
- 前端渲染：HTML5 Canvas。
  - 步骤：绘制原图 → 计算字幕区域高度 → 从底部向上逐行绘制背景条 → 在条内居中绘制描边与填充文字。
  - 文本居中：使用 measureText 获取宽度，结合条宽计算居中坐标。
  - 高 DPI：根据设备像素比放大 Canvas，导出清晰图。
- 颜色输入：提供拾色器与 HEX 输入框双向绑定。
- 字体加载：使用 CSS font-face 或系统字体回退；中文优先“微软雅黑”，英文回退 Arial/Helvetica。

### 10. 兼容性与性能
- 浏览器：Chrome、Edge（最新版），移动端视口自适应。
- 性能：对 4000×3000 像素图片在中端设备内 1s 内完成渲染；使用离屏 Canvas 避免布局抖动。

### 11. 安全与隐私
- 所有处理在本地浏览器完成，不上传图片到服务器。
- 不存储用户图片与文本（除非后续增加“本地缓存”选项）。

### 12. 验收标准
- 统一背景条：同一张图内所有行的背景条颜色、透明度、圆角、内边距完全一致。
- 切割感：相邻背景条之间的垂直空隙清晰可见、间距一致。
- 文本居中：每一行文字水平与垂直居中于对应背景条。
- 实时预览：修改任一参数或文本，预览 300ms 内更新。
- 导出一致性：导出 PNG 与预览视觉一致，分辨率与原图一致。

### 13. 非目标
- 不支持视频、GIF 的动态字幕。
- 不提供自动分句与智能换行（后续可规划）。
- 不提供在线字体商店与授权管理。

## UI 结构草案
- 左侧面板：
  - 上传图片卡片（选择图片按钮、文件名展示）
  - 字幕设置卡片（字幕高度、字体大小、字体颜色、轮廓颜色、字体样式、字体粗细）
  - 字幕内容卡片（多行文本框）
  - 操作按钮（生成字幕图片、保存图片）
- 右侧面板：
  - 预览卡片（图片 + 底部多行字幕条）
  - 底部状态提示（成功/错误）

## 后续可扩展
- 可调描边宽度、背景条颜色与透明度。
- 可选“左/中/右”对齐与文本最大宽度策略。
- 一键应用模板（预设一组参数风格）。
